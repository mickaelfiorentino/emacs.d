#+STARTUP: content
#+AUTHOR: Mickael Fiorentino

* Basics 
** Defaults
#+BEGIN_SRC emacs-lisp
  (setq-default
   delete-by-moving-to-trash t                      ; Delete files to trash
   display-time-format "%H:%M"                      ; Format the time string
   fill-column 100                                  ; Set width for automatic line breaks
   help-window-select t                             ; Focus new help windows when opened
   indent-tabs-mode nil                             ; Stop using tabs to indent
   tab-width 4                                      ; Set width for tabs
   tab-always-indent 'complete                      ; Tabs perform completion
   inhibit-startup-screen t                         ; Disable start-up screen
   initial-scratch-message ""                       ; Empty the initial *scratch* buffer
   make-backup-files nil                            ; No backup files
   auto-save-default nil                            ; No auto-save
   mouse-yank-at-point t                            ; Yank at point rather than pointer
   scroll-conservatively most-positive-fixnum       ; Always scroll by one line
   scroll-margin 0                                  ; Add a margin when scrolling vertically
   select-enable-clipboard t                        ; Merge system's and Emacs' clipboard
   show-trailing-whitespace nil                     ; Display trailing whitespaces
   uniquify-buffer-name-style 'forward              ; uniquify buffer names
   window-combination-resize t                      ; Resize windows proportionally
   visible-bell 1                                   ; Please don't beep at me
   x-stretch-cursor t)                              ; Stretch cursor to the glyph width
  (set-default-coding-systems 'utf-8)               ; Default to utf-8 encoding
  (fset 'yes-or-no-p 'y-or-n-p)                     ; Replace yes/no prompts with y/n
  (global-subword-mode 1)                           ; Iterate through CamelCase words
  (delete-selection-mode 1)                         ; Replace region when inserting text
  (display-time-mode 1)                             ; Enable time in the mode-line
  (show-paren-mode 1)                               ; Show matching parenthesis
  (when (display-graphic-p)
    (fringe-mode 0)                                 ; Disable fringes
    (menu-bar-mode -1)                              ; Disable the menu bar
    (tool-bar-mode -1)                              ; Disable tool-bar
    (scroll-bar-mode -1))                           ; Disable Scroll bar
#+END_SRC

** Keybindings
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "RET")         'newline-and-indent)  
  (global-set-key (kbd "M-0")         'delete-window)
  (global-set-key (kbd "M-1")         'delete-other-windows)
  (global-set-key (kbd "M-2")         'split-window-vertically)
  (global-set-key (kbd "M-3")         'split-window-horizontally)
  (global-set-key (kbd "M-o")         'other-window)
  (global-set-key (kbd "M-O")         'other-frame)
  (global-set-key (kbd "M-k")         'kill-buffer-and-window)
  (global-set-key (kbd "M-g")         'goto-line)
  (global-set-key (kbd "M-/")         'shell-command-on-region)
  (global-set-key (kbd "C-x C-b")     'ibuffer)
  (global-set-key (kbd "<C-return>")  "\C-a\C- \C-e\M-w\C-j\C-y") ; Duplicate line
  (global-set-key (kbd "C-c h")       'counsel-command-history)
  (global-set-key (kbd "C-c t")       'org-time-stamp)
  (global-set-key (kbd "C-c q")       'quick-calc) ;; convert hexa --> 16#<hex> RET 
  (global-set-key (kbd "C-c l")       'downcase-dwim)
  (global-set-key (kbd "C-c u")       'upcase-dwim)
  (global-set-key (kbd "C-c l")       'downcase-dwim)
  (global-set-key (kbd "C-c a")       'align-regexp)
  (global-set-key (kbd "<mouse-9>")   'next-buffer)
  (global-set-key (kbd "<mouse-8>")   'previous-buffer)
#+END_SRC

** Packages

 - Add Melpa and org repos
 #+BEGIN_SRC emacs-lisp
   (require 'package)
   (add-to-list 'package-archives '("melpa" . "http://melpa.org/packages/") t)
   ;; (add-to-list 'package-archives '("melpa-stable" . "http://stable.melpa.org/packages/") t)
   (add-to-list 'package-archives '("org" . "http://orgmode.org/elpa/") t)
   (package-initialize)
 #+END_SRC

 - Add a local directory for custom elisp code
 #+BEGIN_SRC emacs-lisp
 (add-to-list 'load-path (expand-file-name "lisp/" user-emacs-directory))
 #+END_SRC

** use-package
 - Install packages if they are not installed
 #+BEGIN_SRC emacs-lisp
 (mapc
  (lambda (package)
    (if (not (package-installed-p package))
        (progn
          (package-refresh-contents)
          (package-install package))))
    '(use-package diminish bind-key))

 (eval-when-compile (require 'use-package))
 (require 'diminish)
 (require 'bind-key)
 (setq use-package-always-ensure t)
 #+END_SRC

** Daemon
 - Allow access from emacsclient
 #+BEGIN_SRC emacs-lisp
 (use-package server
   :config
   (unless (server-running-p) (server-start)))
 #+END_SRC

 - Alias in .bashrc:
 #+BEGIN_SRC shell
 alias e="emacsclient -n"
 #+END_SRC

** Desktops
  #+BEGIN_SRC emacs-lisp
  (use-package desktop+
    :ensure t
    :config
    (setq desktop-save t)   
    (setq desktop-buffers-not-to-save "^$")
    (setq desktop-files-not-to-save (not desktop-buffers-not-to-save))
    (setq desktop+-base-dir (expand-file-name "desktop/" user-emacs-directory))
    :bind ("C-c d" . desktop+-load)
    :init (add-hook 'after-init-hook (lambda () (desktop+-load "default"))))
  #+END_SRC

** Themes
   - Global
   #+BEGIN_SRC emacs-lisp
     (when (display-graphic-p)
       (load-theme 'tango-plus t)
       (set-face-attribute 'default nil :font "Hack"))
   #+END_SRC

   - Modeline
   #+BEGIN_SRC emacs-lisp
    (when (display-graphic-p)
      (use-package smart-mode-line
        :init
        (setq sml/no-confirm-load-theme t)
        (setq sml/theme 'light) ;; automatic light dark respectful
        :config
        (sml/setup)))
   #+END_SRC

** YaSnippets
   #+BEGIN_SRC emacs-lisp
   (use-package yasnippet                  ; Snippets
   :ensure t
   :diminish yas
   :config
   (setq yas-verbosity 1                      
         yas-wrap-around-region t)

   (add-to-list #'yas-snippet-dirs "~/.emacs.d/emacs.d/yasnippets")
   (yas-reload-all)
   (yas-global-mode))

   #+END_SRC

   #+BEGIN_SRC emacs-lisp
   (use-package yasnippet-snippets         
   :ensure t)
   #+END_SRC
   
* Navigation
** Projectile 
#+BEGIN_SRC emacs-lisp
 (use-package projectile
   :diminish 
   (projectile-mode . "Prj")   
   :config
   (projectile-mode)
   (define-key projectile-mode-map (kbd "C-c p") 'projectile-command-map))
#+END_SRC

** Ibuffer
#+BEGIN_SRC emacs-lisp
(use-package ibuffer-projectile
  :init
  (add-hook 'ibuffer-hook
    (lambda ()
      (ibuffer-projectile-set-filter-groups)
      (unless (eq ibuffer-sorting-mode 'alphabetic)
        (ibuffer-do-sort-by-alphabetic)))))
#+END_SRC

** Ag
- [[https://github.com/ggreer/the_silver_searcher][ag]]
#+BEGIN_SRC emacs-lisp
(defvar executable-ag-available
  (executable-find "ag"))

(use-package ag
  :if executable-ag-available
  :bind
  ("M-?" . ag-project))
#+END_SRC

** Ivy
#+BEGIN_SRC emacs-lisp
(use-package ivy
  :ensure t
  :diminish (ivy-mode . "")
  :bind 
  (:map ivy-mode-map ("C-'" . ivy-avy))
  :config
  (ivy-mode 1)
  (setq ivy-use-virtual-buffers t)
  (setq ivy-height 10)
  (setq ivy-count-format "(%d/%d)")
  (setq ivy-display-style 'fancy)
  (setq ivy-initial-inputs-alist nil)
  (setq ivy-re-builders-alist
  ;; allow input not in order
  '((t   . ivy--regex-ignore-order))))
#+END_SRC

** Counsel
#+BEGIN_SRC emacs-lisp
(use-package counsel
  :config
  (counsel-projectile-mode)
  :bind (("M-x"     . counsel-M-x)
         ("C-x C-f" . counsel-find-file)
         ("C-="     . counsel-projectile-switch-to-buffer)
         ("C-+"     . counsel-projectile-switch-project)
         ("C-M-s"   . counsel-ag)))
#+END_SRC
   
** Swiper
   #+BEGIN_SRC emacs-lisp
   (use-package swiper
     :bind ("C-s" . swiper))
   #+END_SRC
** ace-window
   - Move accross windows.
   - If <n> windows (more than 2) use ~C-M-o <n>~ to switch to that window.
   - To show the list of possible action use ~C-M-o ?~
   #+BEGIN_SRC emacs-lisp
   (use-package ace-window
   :bind ("C-M-o" . ace-window))
   #+END_SRC
** Company
#+BEGIN_SRC emacs-lisp
  (use-package company
    :defer t
    :diminish 
    (company-mode . "Cmp")
    :init 
    (add-hook 'after-init-hook 'global-company-mode)
    :config 
    (add-to-list 'company-backends 'company-files t)
    (add-to-list 'company-backends 'company-shell-env t)
    (setq company-backends (remove 'company-clang company-backends))
    ;; (cl-pushnew '(company-files company-shell-env) company-backends)
    (setq company-minimum-prefix-length 2
          company-selection-wrap-around t
          company-show-numbers t
          company-tooltip-align-annotations t
          company-require-match nil
          company-dabbrev-downcase nil
          company-dabbrev-ignore-case nil)
  )
#+END_SRC

** Expand-Region
   #+BEGIN_SRC emacs-lisp
   (use-package expand-region
	  :ensure
      :bind (
	   ("C-."  . er/expand-region)
	   ("C-M-." . er/contract-region)))
   #+END_SRC

** Multiple Cursors
   #+BEGIN_SRC emacs-lisp
   (use-package multiple-cursors
   :ensure
   :bind (("C->"     . mc/mark-next-like-this)
          ("C-<"     . mc/mark-previous-like-this)
          ("C-c C->" . mc/edit-lines)
          ("C-c C-<" . mc/mark-all-like-this)))
   #+END_SRC

** idedit
   - Edit one occurrence of some text in a buffer or region, and simultaneously have other
     occurrences edited in the same way
   #+BEGIN_SRC emacs-lisp
   (use-package iedit
    :ensure
    :bind (("C-;" . iedit-mode) 
           ("C-:" . iedit-mode-from-isearch)))
   #+END_SRC

** Speedbar
   - speedbar
   #+BEGIN_SRC emacs-lisp
   (use-package speedbar 
   :config 
   (setq speedbar-use-images nil 
         speedbar-show-unknown-files t)) 
   #+END_SRC

   - sr-speedbar
   #+BEGIN_SRC emacs-lisp
  (use-package sr-speedbar 
   :ensure t
   :after speedbar
   :config 
   (setq sr-speedbar-right-side nil 
         sr-speedbar-max-width 40
         sr-speedbar-width 30 
         sr-speedbar-default-width 30
         sr-speedbar-skip-other-window-p t))
   #+END_SRC
** Undo-tree
   #+BEGIN_SRC emacs-lisp
   (use-package undo-tree
     :diminish undo-tree-mode
     :config (global-undo-tree-mode 1)
     :bind ("M-u"   . undo-tree-undo) 
           ("C-M-u" . undo-tree-redo))
   #+END_SRC


* Shell
** Terminal

  - Clear shell
  #+BEGIN_SRC emacs-lisp
  (add-hook 'shell-mode-hook
    (lambda () (local-set-key (kbd "C-l") 'comint-clear-buffer)))
  #+END_SRC
 
  - Color support
  #+BEGIN_SRC emacs-lisp
  (add-hook 'shell-mode-hook
            (lambda ()
              (face-remap-set-base 'comint-highlight-prompt :inherit nil)))
  #+END_SRC

** Tramp
 #+BEGIN_SRC emacs-lisp
 (use-package tramp
   :config
   (add-to-list 'tramp-remote-path 'tramp-own-remote-path)
   (progn 
     (setq tramp-default-method "ssh")))
  
 #+END_SRC
** Dired
   - Load Dired-X
     #+BEGIN_SRC emacs-lisp
     (add-hook 'dired-load-hook
     (function (lambda () (load "dired-x"))))
     #+END_SRC

   - Reuse buffer when visiting parent directory 
     #+BEGIN_SRC emacs-lisp
     (add-hook 'dired-mode-hook
       (lambda () (define-key dired-mode-map (kbd "^")
          (lambda () (interactive) (find-alternate-file "..")))))
     #+END_SRC

** Magit
 #+BEGIN_SRC emacs-lisp
 (use-package magit
   :ensure
   :bind ("C-x g" . magit-status))
 #+END_SRC


* Write
** Org
 - TODOs
 #+BEGIN_SRC emacs-lisp
 (setq org-todo-keywords '((sequence "TODO" "PROCESS" "|" "DONE" )))
 #+END_SRC

 - Export
 #+BEGIN_SRC emacs-lisp
 (require 'ox)
 (setq org-latex-listings 'minted)
 (setq org-latex-pdf-process
       '("pdflatex --shell-escape --interaction nonstopmode %f"
         "bibtex %b"
         "pdflatex --shell-escape --interaction nonstopmode %f"
         "pdflatex --shell-escape --interaction nonstopmode %f"))
 (add-to-list 'org-latex-packages-alist '("" "listings"))
 (add-to-list 'org-latex-packages-alist '("" "color"))
 (add-to-list 'org-latex-packages-alist '("" "minted"))
 #+END_SRC

** Latex
 - Use auctex + evince + synctex
 #+BEGIN_SRC emacs-lisp
 (use-package tex
   :ensure auctex
   :config
   (setq TeX-auto-save t
         TeX-parse-self t
         TeX-view-program-list '(("Evince" "evince --page-index=%(outpage) %o"))
         TeX-view-program-selection '((output-pdf "Evince"))
         TeX-source-correlate-start-server t)
   (add-hook 'TeX-after-compilation-finished-functions #'TeX-revert-document-buffer)
   (add-hook 'LaTeX-mode-hook 'TeX-source-correlate-mode))

 ;; (setq LaTeX-command-style '(("" "%(PDF)%(latex) --shell-escape %S%(PDFout)")))  
 #+END_SRC

  - Configure the integration with external PDF reader
  #+BEGIN_SRC emacs-lisp
  (setq LaTeX-command-style '(("" "%(PDF)%(latex) --shell-escape %S%(PDFout)")))
  #+END_SRC

** Bibtex
 #+BEGIN_SRC emacs-lisp
 (use-package ivy-bibtex
   :ensure t
   :config
   (autoload 'ivy-bibtex "ivy-bibtex" "" t)
   (setq ivy-re-builders-alist
       '((ivy-bibtex . ivy--regex-ignore-order)
         (t . ivy--regex-plus)))
   :init
   (setq bibtex-completion-bibliography "~/Projects/research/bibliography/Library.bib")
   (setq bibtex-completion-notes-path   "~/Projects/research/bibliography/Library.org")
   (setq bibtex-completion-pdf-symbol   "⌘")
   (setq bibtex-completion-notes-symbol "✎")
   (setq bibtex-completion-pdf-open-function 
        (lambda (fpath)
            (call-process "evince" nil 0 nil fpath))))
 #+END_SRC
   
** Org-Ref
#+BEGIN_SRC emacs-lisp
  (use-package org-ref
    :after org
    :init
    (setq org-ref-default-bibliography '("~/Projects/research/bibliography/Library.bib"))
    (setq org-ref-bibliography-notes   "~/Projects/research/bibliography/Library.org")
    (setq org-ref-completion-library   'org-ref-ivy-cite))
#+END_SRC
   
** Markdown
#+BEGIN_SRC emacs-lisp
(use-package markdown-mode
  :ensure t
  :mode (("\\.md\\'" . markdown-mode)
         ("\\.markdown\\'" . markdown-mode))
)
#+END_SRC

** Dokuwiki
   - Dokuwiki Login
   #+BEGIN_SRC emacs-lisp
   (setq dokuwiki-xml-rpc-url "https://nastasia.no-ip.ca/dokuwiki/lib/exe/xmlrpc.php")
   (setq dokuwiki-login-user-name "mickael")   
   #+END_SRC
   - Dokuwiki mode 
   #+BEGIN_SRC emacs-lisp
   (add-to-list 'auto-mode-alist '("\\.dwiki\\'" . dokuwiki-mode))
   #+END_SRC


* Code
** VHDL 

   - Customize VHDL-mode
   #+BEGIN_SRC emacs-lisp
   (defun my-vhdl-mode-hook ()
     (setq vhdl-standard (quote (08 nil)))
     (define-key vhdl-mode-map (kbd "<backtab>") 'vhdl-align-region)
     (define-key vhdl-mode-map " " nil))     
   #+END_SRC
   
   - VHDL-Hook
   #+BEGIN_SRC emacs-lisp
   (add-hook 'vhdl-mode-hook 'my-vhdl-mode-hook)
   #+END_SRC 

** TCL
   - Associate .sdc & .do files to tcl-mode  
   #+BEGIN_SRC emacs-lisp
   (add-to-list 'auto-mode-alist '("\\.sdc\\'" . tcl-mode))
   (add-to-list 'auto-mode-alist '("\\.do\\'" . tcl-mode))
   (add-hook 'inferior-tcl-mode-hook
     (lambda () (local-set-key (kbd "C-l") 'comint-clear-buffer)))
    #+END_SRC
 
** C
  #+BEGIN_SRC emacs-lisp
  (add-hook 'c-mode-common-hook 
      (lambda () (setq-default c-default-style "linux"
                               c-basic-offset  4)))
  #+END_SRC

** ASM
  #+BEGIN_SRC emacs-lisp
  (add-to-list 'auto-mode-alist '("\\.S\\'" . asm-mode))

  (add-hook 'asm-mode-hook
      (lambda () (progn (setq asm-comment-char "//") 
                        (setq comment-start "//")
                        (setq comment-add 0))))

  #+END_SRC

** Python
 #+BEGIN_SRC emacs-lisp
 (add-hook 'python-mode-hook
     (lambda ()
     (setq indent-tabs-mode nil)
     (setq python-indent 4)))
 #+END_SRC
